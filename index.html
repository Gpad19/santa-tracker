<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NORAD Santa Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/cesium@1.113/Build/Cesium/Cesium.js"></script>
<link href="https://cdn.jsdelivr.net/npm/cesium@1.113/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
<style>
html, body, #cesiumContainer {
    width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
}
.label {
    position: absolute;
    top: 10px; left: 10px;
    padding: 10px;
    background: rgba(0,0,0,0.5);
    color: white;
    border-radius: 5px;
    font-family: sans-serif;
    z-index: 100;
}
</style>
</head>
<body>
<div id="cesiumContainer"></div>
<div class="label">ðŸŽ… NORAD Santa Tracker</div>

<script>
// --- Force WebGL1 for iPad Safari ---
Cesium.FeatureDetection.supportsWebGL2 = false;

// Cesium Ion token (required)
Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjEyOGQ2Mi1jMGUwLTRhNmMtYThhZi1lYTcyMzAwYWFiMDYiLCJpZCI6MTIxODQ5LCJpYXQiOjE2NzQxNjE4MDh9.-_OgfjufhglZ0BdQkgwdlNqABiJNfe61EzpscAFljBE';

// Delay initialization slightly for iPad
setTimeout(() => {
    const viewer = new Cesium.Viewer('cesiumContainer', {
        imageryProvider: Cesium.createWorldImagery(),
        baseLayerPicker: false,
        timeline: false,
        animation: false,
        scene3DOnly: true,
        shouldAnimate: true
    });

    // --- Santa flight path ---
    const santaPath = [];
    for (let lon = -180; lon <= 180; lon += 2) {
        const lat = 30 * Math.sin((lon / 180) * Math.PI);
        santaPath.push([lon, lat]);
    }

    // Smooth position
    const santaPosition = new Cesium.SampledPositionProperty();
    const startTime = Cesium.JulianDate.now();
    santaPath.forEach((coord, i) => {
        const time = Cesium.JulianDate.addSeconds(startTime, i * 2, new Cesium.JulianDate());
        santaPosition.addSample(Cesium.JulianDate.clone(time), Cesium.Cartesian3.fromDegrees(coord[0], coord[1], 1500000));
    });

    const totalDuration = santaPath.length * 2;
    viewer.clock.startTime = Cesium.JulianDate.clone(startTime);
    viewer.clock.currentTime = Cesium.JulianDate.clone(startTime);
    viewer.clock.stopTime = Cesium.JulianDate.addSeconds(startTime, totalDuration, new Cesium.JulianDate());
    viewer.clock.clockRange = Cesium.ClockRange.LOOP_STOP;
    viewer.clock.shouldAnimate = true;

    // --- Santa entity ---
    const santa = viewer.entities.add({
        id: 'santa',
        name: "Santa",
        position: santaPosition,
        billboard: {
            image: "https://upload.wikimedia.org/wikipedia/commons/1/1e/Santa_Claus_icon.svg",
            scale: 0.12,
            verticalOrigin: Cesium.VerticalOrigin.BOTTOM
        },
        label: {
            text: "ðŸŽ… Santa",
            font: "24px sans-serif",
            verticalOrigin: Cesium.VerticalOrigin.TOP,
            pixelOffset: new Cesium.Cartesian2(0, -30)
        },
        path: {
            show: true,
            leadTime: 0,
            trailTime: totalDuration,
            width: 5,
            material: Cesium.Color.RED
        }
    });

    // --- Example visited cities ---
    const cities = [
        { name: 'New York', lon: -74.006, lat: 40.7128 },
        { name: 'London', lon: -0.1276, lat: 51.5074 },
        { name: 'Tokyo', lon: 139.6917, lat: 35.6895 }
    ];
    cities.forEach(city => {
        viewer.entities.add({
            name: city.name,
            position: Cesium.Cartesian3.fromDegrees(city.lon, city.lat, 0),
            point: {
                pixelSize: 10,
                color: Cesium.Color.YELLOW,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 1
            },
            label: {
                text: city.name,
                font: '16px sans-serif',
                verticalOrigin: Cesium.VerticalOrigin.TOP,
                pixelOffset: new Cesium.Cartesian2(0, -15)
            }
        });
    });

    // Camera follows Santa
    viewer.trackedEntity = santa;

    // Touch-friendly camera
    viewer.scene.screenSpaceCameraController.enableRotate = true;
    viewer.scene.screenSpaceCameraController.enableTranslate = true;
    viewer.scene.screenSpaceCameraController.enableZoom = true;
    viewer.scene.screenSpaceCameraController.enableTilt = true;
    viewer.scene.screenSpaceCameraController.enableLook = true;

    window.addEventListener('resize', () => viewer.resize());
}, 500); // small delay for iPad
</script>
</body>
</html>

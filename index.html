<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Santa Tracker ğŸ…</title>

  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- Cesium -->
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Widgets/widgets.css"
        rel="stylesheet" />

  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
    }

    #info {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(0, 0, 0, 0.65);
      color: white;
      padding: 14px 18px;
      border-radius: 12px;
      font-family: system-ui, -apple-system;
      font-size: 14px;
      z-index: 10;
      min-width: 240px;
      line-height: 1.5;
    }

    #zoomSanta {
      position: absolute;
      top: 140px;
      left: 12px;
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: rgba(255, 0, 0, 0.85);
      color: white;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      z-index: 10;
    }

    #zoomSanta:hover {
      background: rgba(255, 0, 0, 1);
    }
  </style>
</head>

<body>

<div id="cesiumContainer"></div>
<div id="info">ğŸ… Preparing for departureâ€¦</div>
<button id="zoomSanta">ğŸ… Zoom to Santa</button>

<script>
/* =====================================
   ğŸ”‘ Cesium ion token
===================================== */
Cesium.Ion.defaultAccessToken =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjEyOGQ2Mi1jMGUwLTRhNmMtYThhZi1lYTcyMzAwYWFiMDYiLCJpZCI6MTIxODQ5LCJpYXQiOjE2NzQxNjE4MDh9.-_OgfjufhglZ0BdQkgwdlNqABiJNfe61EzpscAFljBE";

/* =====================================
   ğŸŒ Viewer
===================================== */
const viewer = new Cesium.Viewer("cesiumContainer", {
  animation: true,
  timeline: true,
  shouldAnimate: true
});

viewer.scene.globe.enableLighting = true;

/* =====================================
   â° Timeline
===================================== */
const santaStart = Cesium.JulianDate.fromIso8601("2026-12-24T11:00:00Z");
const santaEnd   = Cesium.JulianDate.fromIso8601("2026-12-25T11:00:00Z");

/* =====================================
   ğŸ™ Cities (East â†’ West)
===================================== */
const cities = [
  { name: "North Pole", lon: -135, lat: 90, stop: 180 },
  { name: "Auckland", lon: 174.76, lat: -36.85, stop: 120 },
  { name: "Sydney", lon: 151.2, lat: -33.8, stop: 120 },
  { name: "Tokyo", lon: 139.7, lat: 35.7, stop: 120 },
  { name: "Seoul", lon: 126.98, lat: 37.56, stop: 120 },
  { name: "Manila", lon: 120.98, lat: 14.6, stop: 120 },
  { name: "Beijing", lon: 116.4, lat: 39.9, stop: 120 },
  { name: "Hanoi", lon: 105.85, lat: 21.03, stop: 120 },
  { name: "Jakarta", lon: 106.85, lat: -6.21, stop: 120 },
  { name: "Singapore", lon: 103.82, lat: 1.35, stop: 120 },
  { name: "Bangkok", lon: 100.5, lat: 13.75, stop: 120 },
  { name: "Mumbai", lon: 72.87, lat: 19.07, stop: 120 },
  { name: "Tehran", lon: 51.39, lat: 35.69, stop: 120 },
  { name: "Dubai", lon: 55.27, lat: 25.2, stop: 120 },
  { name: "Cairo", lon: 31.23, lat: 30.04, stop: 120 },
  { name: "Athens", lon: 23.72, lat: 37.98, stop: 120 },
  { name: "Cape Town", lon: 18.42, lat: -33.92, stop: 120 },
  { name: "Berlin", lon: 13.41, lat: 52.52, stop: 120 },
  { name: "Rome", lon: 12.49, lat: 41.89, stop: 120 },
  { name: "Paris", lon: 2.35, lat: 48.86, stop: 120 },
  { name: "Madrid", lon: -3.7, lat: 40.42, stop: 120 },
  { name: "Lisbon", lon: -9.14, lat: 38.72, stop: 120 },
  { name: "London", lon: -0.1, lat: 51.5, stop: 120 },
  { name: "Reykjavik", lon: -21.82, lat: 64.13, stop: 120 },
  { name: "SÃ£o Paulo", lon: -46.63, lat: -23.55, stop: 120 },
  { name: "Buenos Aires", lon: -58.38, lat: -34.6, stop: 120 },
  { name: "Santiago", lon: -70.66, lat: -33.45, stop: 120 },
  { name: "Lima", lon: -77.04, lat: -12.04, stop: 120 },
  { name: "New York", lon: -74.0, lat: 40.7, stop: 120 },
  { name: "Toronto", lon: -79.38, lat: 43.65, stop: 120 },
  { name: "Mexico City", lon: -99.13, lat: 19.43, stop: 120 },
  { name: "Los Angeles", lon: -118.24, lat: 34.05, stop: 120 },
  { name: "Anchorage", lon: -149.9, lat: 61.2, stop: 120 },
  { name: "Honolulu", lon: -157.86, lat: 21.31, stop: 120 },
  { name: "North Pole", lon: -135, lat: 90, stop: 180 }
];

/* =====================================
   ğŸ§® Timing math
===================================== */
const totalSeconds =
  Cesium.JulianDate.secondsDifference(santaEnd, santaStart);

const totalStopSeconds =
  cities.reduce((s, c) => s + c.stop, 0);

const travelPerLeg =
  (totalSeconds - totalStopSeconds) / (cities.length - 1);

/* =====================================
   ğŸ“ Path
===================================== */
const position = new Cesium.SampledPositionProperty();
let t = santaStart.clone();
const arcSamples = 64;

cities.forEach((city, i) => {
  city.arrival = t.clone();
  const p = Cesium.Cartesian3.fromDegrees(city.lon, city.lat, 300000);
  position.addSample(city.arrival, p);

  t = Cesium.JulianDate.addSeconds(t, city.stop, new Cesium.JulianDate());
  city.departure = t.clone();
  position.addSample(city.departure, p);

  if (i < cities.length - 1) {
    const next = cities[i + 1];
    const geo = new Cesium.EllipsoidGeodesic(
      Cesium.Cartographic.fromDegrees(city.lon, city.lat),
      Cesium.Cartographic.fromDegrees(next.lon, next.lat)
    );

    for (let j = 1; j <= arcSamples; j++) {
      const f = j / arcSamples;
      const c = geo.interpolateUsingFraction(f);
      const h = 300000 + Math.sin(Math.PI * f) * 200000;

      const tt = Cesium.JulianDate.addSeconds(
        city.departure,
        travelPerLeg * f,
        new Cesium.JulianDate()
      );

      position.addSample(
        tt,
        Cesium.Cartesian3.fromRadians(c.longitude, c.latitude, h)
      );
    }

    t = Cesium.JulianDate.addSeconds(t, travelPerLeg, new Cesium.JulianDate());
  }
});

/* =====================================
   ğŸ… Santa
===================================== */
const santa = viewer.entities.add({
  availability: new Cesium.TimeIntervalCollection([
    new Cesium.TimeInterval({ start: santaStart, stop: santaEnd })
  ]),
  position,
  point: {
    pixelSize: 12,
    color: Cesium.Color.RED,
    outlineColor: Cesium.Color.WHITE,
    outlineWidth: 2
  },
  path: {
    width: 2,
    material: Cesium.Color.RED
  }
});

viewer.trackedEntity = santa;

/* =====================================
   ğŸ“¢ Status + Countdown
===================================== */
const info = document.getElementById("info");

function formatCountdown(seconds) {
  seconds = Math.max(0, Math.floor(seconds));
  const h = String(Math.floor(seconds / 3600)).padStart(2, "0");
  const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, "0");
  const s = String(seconds % 60).padStart(2, "0");
  return `${h}:${m}:${s}`;
}

viewer.clock.startTime = santaStart.clone();
viewer.clock.stopTime = santaEnd.clone();
viewer.clock.clockRange = Cesium.ClockRange.CLAMPED;
viewer.clock.clockStep = Cesium.ClockStep.SYSTEM_CLOCK;

viewer.clock.onTick.addEventListener(clock => {
  const now = clock.currentTime;

  if (Cesium.JulianDate.lessThan(now, santaStart)) {
    info.innerHTML = "ğŸ… Preparing for departureâ€¦";
    return;
  }

  if (Cesium.JulianDate.greaterThan(now, santaEnd)) {
    info.innerHTML = "ğŸ„ Santa has completed deliveries!";
    return;
  }

  for (let i = 0; i < cities.length; i++) {
    if (
      Cesium.JulianDate.lessThanOrEquals(cities[i].arrival, now) &&
      (i === cities.length - 1 ||
       Cesium.JulianDate.greaterThan(cities[i + 1].arrival, now))
    ) {
      const next = cities[i + 1];
      if (next) {
        const seconds =
          Cesium.JulianDate.secondsDifference(next.arrival, now);

        info.innerHTML = `
          ğŸ… Santa is in<br>
          <strong>${cities[i].name}</strong><br><br>
          ğŸ¯ Next stop: <strong>${next.name}</strong><br>
          â³ Arrival in: <strong>${formatCountdown(seconds)}</strong>
        `;
      }
      break;
    }
  }
});

/* =====================================
   ğŸ¥ Zoom button
===================================== */
document.getElementById("zoomSanta").onclick = () => {
  const pos = santa.position.getValue(viewer.clock.currentTime);
  if (!pos) return;

  viewer.camera.flyTo({
    destination: Cesium.Cartesian3.multiplyByScalar(
      Cesium.Cartesian3.normalize(pos, new Cesium.Cartesian3()),
      Cesium.Cartesian3.magnitude(pos) + 1_000_000,
      new Cesium.Cartesian3()
    ),
    duration: 2.5
  });
};

/* =====================================
   ğŸ¥ Initial camera
===================================== */
viewer.camera.flyTo({
  destination: Cesium.Cartesian3.fromDegrees(-135, 80, 3_000_000)
});
</script>

</body>
</html>

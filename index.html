<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Santa Tracker ðŸŽ…</title>

  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.115/Build/Cesium/Widgets/widgets.css"
        rel="stylesheet" />

  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.65);
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      font-family: system-ui, -apple-system;
      font-size: 14px;
      z-index: 10;
      min-width: 200px;
    }
  </style>
</head>
<body>

<div id="cesiumContainer"></div>
<div id="info">ðŸŽ… Preparing for departureâ€¦</div>

<script>
  // =====================================
  // ðŸ”‘ Cesium ion token (REQUIRED)
  // =====================================
  Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjEyOGQ2Mi1jMGUwLTRhNmMtYThhZi1lYTcyMzAwYWFiMDYiLCJpZCI6MTIxODQ5LCJpYXQiOjE2NzQxNjE4MDh9.-_OgfjufhglZ0BdQkgwdlNqABiJNfe61EzpscAFljBE";

  const viewer = new Cesium.Viewer("cesiumContainer", {
    animation: false,
    timeline: false,
    baseLayerPicker: false,
    geocoder: false,
    homeButton: false,
    sceneModePicker: false,
    navigationHelpButton: false,
    fullscreenButton: false,
    shouldAnimate: true
  });

  viewer.scene.globe.enableLighting = true;
  viewer.scene.requestRenderMode = true;

  // =====================================
  // â° Santa global time window (UTC)
  // =====================================
  const santaStart = Cesium.JulianDate.fromIso8601("2026-12-24T00:00:00Z");
  const santaEnd   = Cesium.JulianDate.fromIso8601("2026-12-25T00:00:00Z");

  // =====================================
  // ðŸ™ City stops (ordered)
  // =====================================
  const cities = [
    { name: "North Pole", lon: -135, lat: 90 },
    { name: "Anchorage", lon: -149.9, lat: 61.2 },
    { name: "New York", lon: -74.0, lat: 40.7 },
    { name: "London", lon: -0.1, lat: 51.5 },
    { name: "Paris", lon: 2.35, lat: 48.86 },
    { name: "Dubai", lon: 55.27, lat: 25.2 },
    { name: "Mumbai", lon: 72.87, lat: 19.07 },
    { name: "Tokyo", lon: 139.7, lat: 35.7 },
    { name: "Sydney", lon: 151.2, lat: -33.8 }
  ];

  // =====================================
  // ðŸ§® Assign times to each city
  // =====================================
  const totalSeconds =
    Cesium.JulianDate.secondsDifference(santaEnd, santaStart);

  cities.forEach((city, i) => {
    city.time = Cesium.JulianDate.addSeconds(
      santaStart,
      (totalSeconds / (cities.length - 1)) * i,
      new Cesium.JulianDate()
    );
  });

  // =====================================
  // ðŸ“ Santa path
  // =====================================
  const position = new Cesium.SampledPositionProperty();

  cities.forEach(city => {
    position.addSample(
      city.time,
      Cesium.Cartesian3.fromDegrees(city.lon, city.lat, 300000)
    );
  });

  const santa = viewer.entities.add({
    availability: new Cesium.TimeIntervalCollection([
      new Cesium.TimeInterval({ start: santaStart, stop: santaEnd })
    ]),
    position,
    orientation: new Cesium.VelocityOrientationProperty(position),
    model: {
      uri: "https://cdn.jsdelivr.net/gh/AnalyticalGraphicsInc/cesium-assets@master/models/CesiumMan/Cesium_Man.glb",
      minimumPixelSize: 64
    },
    path: {
      width: 3,
      material: Cesium.Color.RED
    }
  });

  viewer.trackedEntity = santa;

  // =====================================
  // ðŸ•° Real-time clock sync
  // =====================================
  viewer.clock.startTime = santaStart.clone();
  viewer.clock.stopTime = santaEnd.clone();
  viewer.clock.clockStep = Cesium.ClockStep.SYSTEM_CLOCK;
  viewer.clock.clockRange = Cesium.ClockRange.CLAMPED;

  // =====================================
  // ðŸ“¢ City detection logic
  // =====================================
  const info = document.getElementById("info");
  let lastCity = null;

  viewer.clock.onTick.addEventListener(clock => {
    const now = clock.currentTime;

    for (let i = cities.length - 1; i >= 0; i--) {
      if (Cesium.JulianDate.lessThanOrEquals(cities[i].time, now)) {
        if (lastCity !== cities[i].name) {
          lastCity = cities[i].name;
          info.innerHTML = `ðŸŽ… Santa is now in<br><strong>${lastCity}</strong>`;
        }
        break;
      }
    }
  });

  viewer.camera.flyTo({
    destination: Cesium.Cartesian3.fromDegrees(-135, 80, 3_000_000)
  });
</script>

</body>
</html>

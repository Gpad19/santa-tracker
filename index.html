<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Santa Tracker</title>

<script src="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Cesium.js"></script>
<link href="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />

<style>
html, body, #cesiumContainer {
  width: 100%;
  height: 100%;
  margin: 0;
  background: #081a2b;
  overflow: hidden;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

#hud {
  position: absolute;
  top: 12px;
  left: 12px;
  background: rgba(0,0,0,0.55);
  color: white;
  padding: 12px 16px;
  border-radius: 10px;
  backdrop-filter: blur(8px);
  font-size: 14px;
}

#title {
  font-weight: 600;
  margin-bottom: 6px;
  font-size: 16px;
}
</style>
</head>

<body>
<div id="cesiumContainer"></div>

<div id="hud">
  <div id="title">üéÖ Santa Tracker</div>
  <div>Stops: <span id="stops">‚Äî</span></div>
  <div>Visited: <span id="visited">0</span></div>
  <div>Country: <span id="country">‚Äî</span></div>
  <div>City: <span id="city">‚Äî</span></div>
</div>

<script>
/* =========================
   CESIUM TOKEN
========================= */
Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiZjEyOGQ2Mi1jMGUwLTRhNmMtYThhZi1lYTcyMzAwYWFiMDYiLCJpZCI6MTIxODQ5LCJpYXQiOjE2NzQxNjE4MDh9.-_OgfjufhglZ0BdQkgwdlNqABiJNfe61EzpscAFljBE";

/* =========================
   CONFIG
========================= */
const TOTAL_SECONDS = 24 * 60 * 60; // 24 hours
const TOTAL_STOPS = 360;
const FLIGHT_HEIGHT = 40000; // ‚≠ê LOWER ALTITUDE (40 km)

/* =========================
   COUNTRY-BASED ROUTE
   (east ‚Üí west, like NORAD)
========================= */
const ROUTE = [
  { country: "New Zealand", cities: [["Auckland",-36.8,174.8],["Wellington",-41.3,174.8]] },
  { country: "Australia", cities: [["Sydney",-33.9,151.2],["Melbourne",-37.8,144.9]] },
  { country: "Japan", cities: [["Tokyo",35.7,139.7],["Osaka",34.7,135.5]] },
  { country: "China", cities: [["Beijing",39.9,116.4],["Shanghai",31.2,121.5]] },
  { country: "India", cities: [["Delhi",28.6,77.2],["Mumbai",19.1,72.9]] },
  { country: "UAE", cities: [["Dubai",25.2,55.3]] },
  { country: "Egypt", cities: [["Cairo",30.0,31.2]] },
  { country: "France", cities: [["Paris",48.9,2.4]] },
  { country: "United Kingdom", cities: [["London",51.5,-0.1]] },
  { country: "Canada", cities: [["Toronto",43.7,-79.4],["Vancouver",49.3,-123.1]] },
  { country: "United States", cities: [["New York",40.7,-74.0],["Chicago",41.9,-87.6],["Denver",39.7,-105.0],["Los Angeles",34.0,-118.2]] },
  { country: "Mexico", cities: [["Mexico City",19.4,-99.1]] }
];

document.getElementById("stops").textContent = TOTAL_STOPS;

/* =========================
   VIEWER
========================= */
const viewer = new Cesium.Viewer("cesiumContainer", {
  animation: false,
  timeline: false,
  baseLayerPicker: false,
  geocoder: false,
  homeButton: false,
  sceneModePicker: false,
  navigationHelpButton: false,
  fullscreenButton: false,
  shouldAnimate: true
});

viewer.scene.globe.depthTestAgainstTerrain = false;
viewer.camera.percentageChanged = 0.005;
viewer.scene.screenSpaceCameraController.enableCollisionDetection = false;

/* =========================
   BUILD ROUTE
========================= */
const path = new Cesium.SampledPositionProperty();
const startTime = Cesium.JulianDate.now();
const secondsPerStop = TOTAL_SECONDS / TOTAL_STOPS;

let routeIndex = 0;

for (let i = 0; i < TOTAL_STOPS; i++) {
  const country = ROUTE[routeIndex % ROUTE.length];
  const city = country.cities[i % country.cities.length];

  const time = Cesium.JulianDate.addSeconds(
    startTime,
    i * secondsPerStop,
    new Cesium.JulianDate()
  );

  path.addSample(
    time,
    Cesium.Cartesian3.fromDegrees(city[2], city[1], FLIGHT_HEIGHT)
  );

  if (i % Math.floor(TOTAL_STOPS / ROUTE.length) === 0) {
    routeIndex++;
  }
}

/* =========================
   SANTA (RED DOT)
========================= */
const santa = viewer.entities.add({
  position: path,
  point: {
    pixelSize: 10,
    color: Cesium.Color.RED,
    outlineColor: Cesium.Color.WHITE,
    outlineWidth: 1,
    disableDepthTestDistance: Number.POSITIVE_INFINITY
  }
});

viewer.trackedEntity = santa;

/* =========================
   CLOCK
========================= */
viewer.clock.startTime = startTime.clone();
viewer.clock.stopTime = Cesium.JulianDate.addSeconds(startTime, TOTAL_SECONDS, new Cesium.JulianDate());
viewer.clock.currentTime = startTime.clone();
viewer.clock.clockRange = Cesium.ClockRange.CLAMPED;
viewer.clock.multiplier = 1;

/* =========================
   CINEMATIC CAMERA
========================= */
let mode = "WIDE";
let lastSwitch = 0;

viewer.scene.postRender.addEventListener(() => {
  const time = viewer.clock.currentTime;
  const pos = santa.position.getValue(time);
  if (!pos) return;

  const elapsed = Cesium.JulianDate.secondsDifference(time, startTime);

  if (elapsed - lastSwitch > 45) {
    mode = mode === "WIDE" ? "CLOSE" : "WIDE";
    lastSwitch = elapsed;
  }

  const height = Cesium.Cartographic.fromCartesian(pos).height;
  const dist = mode === "WIDE"
    ? Cesium.Math.clamp(height * 18, 2_000_000, 6_000_000)
    : Cesium.Math.clamp(height * 8, 700_000, 2_000_000);

  viewer.camera.lookAt(
    pos,
    new Cesium.Cartesian3(-dist, dist * 0.4, dist * 0.6)
  );
});

/* =========================
   HUD UPDATES
========================= */
viewer.clock.onTick.addEventListener(() => {
  const elapsed = Cesium.JulianDate.secondsDifference(
    viewer.clock.currentTime,
    startTime
  );

  const visited = Math.min(Math.floor(elapsed / secondsPerStop), TOTAL_STOPS);
  document.getElementById("visited").textContent = visited;

  const routePos = Math.min(
    Math.floor((visited / TOTAL_STOPS) * ROUTE.length),
    ROUTE.length - 1
  );

  const country = ROUTE[routePos];
  const city = country.cities[visited % country.cities.length];

  document.getElementById("country").textContent = country.country;
  document.getElementById("city").textContent = city[0];
});
</script>
</body>
</html>
